---
layout: post
title: Enabling Frame Rate Counters for HTML Applications in Windows 8
excerpt: 
tags: 
comments: true
---

<p>&#160;</p>  <p><strong>Introduction</strong></p>  <p>Just the other day I blogged about “<a href="http://michaelcrump.net/archive/2011/09/21/enabling-frame-rate-counters-for-xaml-applications-in-windows-8.aspx">Enabling Frame Rate Counter for XAML Applications in Windows 8</a>”. At the very end of that post I reminded everyone that that method does not work for HTML / JS Metro Applications. But we are in luck as <a href="http://channel9.msdn.com/Events/Speakers/mathias+jourdain">Mathias Jourdain</a> provided sample code for accomplishing this in HTML / JS in his Build talk. The only problem was that he didn’t describe how to hook this into a new application to actually use. That is going to be the focus of today’s blog post. </p>  <p><strong>Let’s get started</strong></p>  <p>Unlike <a href="http://michaelcrump.net/archive/2011/09/21/enabling-frame-rate-counters-for-xaml-applications-in-windows-8.aspx">XAML Application</a><a href="http://michaelcrump.net/archive/2011/09/21/enabling-frame-rate-counters-for-xaml-applications-in-windows-8.aspx">s</a> this must be done using code. So click on “Visual Studio 11” to begin. </p>  <p><a href="http://michaelcrump.net/files/image_634587813093410604.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://michaelcrump.net/files/image_thumb_634587813110726937.png" width="249" height="485" /></a></p>  <p>Go ahead and click on “New Project…”</p>  <p>Select JavaScript –&gt; Windows Metro Style –&gt; Blank Application. Finally give it a name and hit OK. </p>  <p><a href="http://michaelcrump.net/files/image_634587813126327237.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://michaelcrump.net/files/image_thumb_634587813152379738.png" width="754" height="445" /></a></p>  <p>Our default.html will be displayed. We are going to keep things simple and only add a &lt;p&gt; tag between the body and give it an id. Below is some sample code: </p>  <pre class="brush: xml;">&lt;!DOCTYPE html&gt;  &lt;html&gt;  &lt;head&gt;      &lt;meta charset=&quot;utf-8&quot; /&gt;      &lt;title&gt;FRCounter&lt;/title&gt;      &lt;!-- WinJS references --&gt;      &lt;link rel=&quot;stylesheet&quot; href=&quot;/winjs/css/ui-dark.css&quot; /&gt;      &lt;script src=&quot;/winjs/js/base.js&quot;&gt;&lt;/script&gt;       &lt;script src=&quot;/winjs/js/wwaapp.js&quot;&gt;&lt;/script&gt;      &lt;!-- FRCounter references --&gt;      &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/default.css&quot; /&gt;      &lt;script src=&quot;/js/default.js&quot;&gt;&lt;/script&gt;  &lt;/head&gt;  &lt;body&gt;      &lt;p id=&quot;myText&quot; /&gt;  &lt;/body&gt;  &lt;/html&gt;</pre>    <p>This paragraph tag will display our framerate when the application is running. </p>    <p>Now if you switch over to the /js/default.js then you will see the following code. </p>    <pre class="brush: js;">(function () {      'use strict';      // Uncomment the following line to enable first chance exceptions.      // Debug.enableFirstChanceException(true);         WinJS.Application.onmainwindowactivated = function (e) {          if (e.detail.kind === Windows.ApplicationModel.Activation.ActivationKind.launch) {              // TODO: startup code here          }      }         WinJS.Application.start();  })();</pre>    <p>You are going to replace it with this code: </p>    <pre class="brush: js;">var lastUIRefreshFPS = 0;  var frameCounter = 0;     (function () {      'use strict';      // Uncomment the following line to enable first chance exceptions.      // Debug.enableFirstChanceException(true);           WinJS.Application.onmainwindowactivated = function(e) {          if (e.detail.kind === Windows.ApplicationModel.Activation.ActivationKind.launch) {                 renderLoopFPS();          }      }            WinJS.Application.start();  })();     (function renderLoopFPS() {      var now = new Date().getTime() % 1000;            if (now &lt; lastUIRefreshFPS) {          // Display the FPS          myText.innerText = frameCounter + &quot; frames&quot;;             // Reset the FPS counter          frameCounter = 0;      }         // Increment the FPS counter      frameCounter += 1;      lastUIRefreshFPS = now;      msRequestAnimationFrame(renderLoopFPS);  })();</pre>    <p>I made some very minor changes to this code and hooked it up to the onmainwindowactivated event. This uses the msRequestAnimationFrame method. You can read it’s documentation <a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh453391(v=vs.85).aspx">here</a>. </p>    <p>If you run the app you should get the following framerate in the middle of the screen as shown below: </p>    <p><a href="http://michaelcrump.net/files/image_634587813154407777.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://michaelcrump.net/files/image_thumb_634587813157683840.png" width="149" height="75" /></a></p>    <p>It is quite a ways off compared to the detail of the <a href="http://michaelcrump.net/archive/2011/09/21/enabling-frame-rate-counters-for-xaml-applications-in-windows-8.aspx">XAML version</a> of the framerate counter and was also more difficult to do (screenshots of XAML version below). </p>    <p><img alt="image" src="http://geekswithblogs.net/images/geekswithblogs_net/mbcrump/Windows-Live-Writer/Enabling-Frame-Rate-Counters-for-XAML-Ap_DE2D/image_thumb_7.png" /></p>    <p><a href="http://michaelcrump.net/files/image_634587813175312179.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://michaelcrump.net/files/image_thumb_634587813189976461.png" width="499" height="282" /></a></p>    <p>Now it is time for you to make the decision do you develop in XAML / C# or HTML / JS? In this blog we will be diving into XAML / C# with Metro but may post the occasional HTML / JS app. =)</p>    <p>Thanks for reading! </p>
