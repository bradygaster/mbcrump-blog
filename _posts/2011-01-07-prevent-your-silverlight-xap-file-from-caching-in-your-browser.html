---
layout: post
title: Prevent your Silverlight XAP file from caching in your browser.
excerpt: 
tags: 
comments: true
---

<p>If you work with Silverlight daily then you have run into this problem. Your XAP file has been cached in your browser and you have to empty your browser cache to resolve it. If your using Google Chrome then you typically do the following: </p>  <p>Go to Options –&gt; Clear Browsing History –&gt; Empty the Cache and finally click Clear Browsing data. </p>  <p><a href="http://michaelcrump.net/files/SNAGHTML1f6c763d_634591075735667975.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="SNAGHTML1f6c763d" border="0" alt="SNAGHTML1f6c763d" src="http://michaelcrump.net/files/SNAGHTML1f6c763d_thumb_634591075758600269.png" width="419" height="451" /></a></p>  <p align="left">As you can see this is a lot of unnecessary steps. It is even worse when you have a customer that says “I can’t see the new features you just implemented!” and you realize it’s a cached xap problem.&#160; I have been struggling with a way to prevent my XAP file from caching inside of a browser for a while now and decided to implement the following solution. </p>  <ol>   <li>If the Visual Studio Debugger <strong>is</strong> attached then add a unique query string to the source param to <strong>force</strong> the XAP file to be refreshed. </li>    <li>If the Visual Studio Debugger <strong>is not</strong> attached then add the source param as Visual Studio generates it. This is also in case I forget to remove the above code in my production environment. </li>    <li>I want the ASP.NET code to be inline with my .ASPX page. (I do not want a separate code behind .cs page or .vb page attached to the .aspx page.) </li> </ol>  <p>Below is an example of the hosting code generated when you create a new Silverlight project. As a quick refresher the hard coded param name = “source” specifies the location of your XAP file.&#160; </p>  <pre class="brush: xml;">&lt;form id=&quot;form1&quot; runat=&quot;server&quot; style=&quot;height:100%&quot;&gt;  &lt;div id=&quot;silverlightControlHost&quot;&gt;      &lt;object data=&quot;data:application/x-silverlight-2&quot; type=&quot;application/x-silverlight-2&quot; width=&quot;100%&quot; height=&quot;100%&quot;&gt;        &lt;param name=&quot;source&quot; value=&quot;ClientBin/SilverlightApplication2.xap&quot;/&gt;        &lt;param name=&quot;onError&quot; value=&quot;onSilverlightError&quot; /&gt;        &lt;param name=&quot;background&quot; value=&quot;white&quot; /&gt;        &lt;param name=&quot;minRuntimeVersion&quot; value=&quot;4.0.50826.0&quot; /&gt;        &lt;param name=&quot;autoUpgrade&quot; value=&quot;true&quot; /&gt;        &lt;a href=&quot;http://go.microsoft.com/fwlink/?LinkID=149156&amp;v=4.0.50826.0&quot; style=&quot;text-decoration:none&quot;&gt;             &lt;img src=&quot;http://go.microsoft.com/fwlink/?LinkId=161376&quot; alt=&quot;Get Microsoft Silverlight&quot; style=&quot;border-style:none&quot;/&gt;        &lt;/a&gt;      &lt;/object&gt;&lt;iframe id=&quot;_sl_historyFrame&quot; style=&quot;visibility:hidden;height:0px;width:0px;border:0px&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;  &lt;/form&gt;</pre>    <p>We are going to use a little bit of inline ASP.NET to generate the param name = source dynamically to prevent the XAP file from caching. Lets look at the completed solution: </p>    <pre class="brush: xml;">&lt;form id=&quot;form1&quot; runat=&quot;server&quot; style=&quot;height:100%&quot;&gt;     &lt;div id=&quot;silverlightControlHost&quot;&gt;         &lt;object data=&quot;data:application/x-silverlight-2&quot; type=&quot;application/x-silverlight-2&quot; width=&quot;100%&quot; height=&quot;100%&quot;&gt;         &lt;%             string strSourceFile = @&quot;ClientBin/SilverlightApplication2.xap&quot;;             string param;                 if (System.Diagnostics.Debugger.IsAttached)                 //Debugger Attached - Refresh the XAP file.                 param = &quot;&lt;param name=\&quot;source\&quot; value=\&quot;&quot; + strSourceFile + &quot;?&quot; + DateTime.Now.Ticks + &quot;\&quot; /&gt;&quot;;             else             {                 //Production Mode                  param = &quot;&lt;param name=\&quot;source\&quot; value=\&quot;&quot; + strSourceFile + &quot;\&quot; /&gt;&quot;;             }             Response.Write(param);          %&gt;            &lt;param name=&quot;onError&quot; value=&quot;onSilverlightError&quot; /&gt;           &lt;param name=&quot;background&quot; value=&quot;white&quot; /&gt;           &lt;param name=&quot;minRuntimeVersion&quot; value=&quot;4.0.50826.0&quot; /&gt;           &lt;param name=&quot;autoUpgrade&quot; value=&quot;true&quot; /&gt;           &lt;a href=&quot;http://go.microsoft.com/fwlink/?LinkID=149156&amp;v=4.0.50826.0&quot; style=&quot;text-decoration:none&quot;&gt;                &lt;img src=&quot;http://go.microsoft.com/fwlink/?LinkId=161376&quot; alt=&quot;Get Microsoft Silverlight&quot; style=&quot;border-style:none&quot;/&gt;           &lt;/a&gt;         &lt;/object&gt;&lt;iframe id=&quot;_sl_historyFrame&quot; style=&quot;visibility:hidden;height:0px;width:0px;border:0px&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;  &lt;/form&gt;</pre>    <p>We add the location to our XAP file to strSourceFile and if the debugger is attached then it will append DateTime.Now.Ticks to the XAP file source and force the browser to download the .XAP. If you view the page source of your Silverlight Application then you can verify it worked properly by looking at the param name = “source” tag as shown below. </p>    <p><a href="http://michaelcrump.net/files/image_634591075764996351.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://michaelcrump.net/files/image_thumb_634591075775916491.png" width="173" height="427" /></a></p>    <pre class="brush: xml;">&lt;param name=&quot;source&quot; value=&quot;ClientBin/SilverlightApplication2.xap?634299001187160148&quot; /&gt; </pre>    <p>If the debugger is not attached then it will use the standard source tag as shown below. </p>    <pre class="brush: xml;">&lt;param name=&quot;source&quot; value=&quot;ClientBin/SilverlightApplication2.xap&quot;/&gt;</pre>    <p>At this point you may be asking How do I prevent my XAP file from being cached on my production app? Well you have two easy options:</p>    <p>1) I really don’t recommend this approach but you can force the XAP to be refreshed everytime with the following code snippet.&#160; </p>    <pre class="brush: xml;">&lt;param name=&quot;source&quot; value=&quot;ClientBin/SilverlightApplication2.xap?&lt;%=Guid.NewGuid().ToString() %&gt;&quot;/&gt;</pre>    <p>NOTE: You could also substitute the “Guid.NewGuid().ToString() for anything that create a random field. (I used DateTime.Now.Ticks earlier). </p>    <p>2) Another solution that I like even better involves checking the XAP Creation Date and appending it to the param name = source. This method was described by <a href="http://codeblog.larsholm.net/2010/02/avoid-incorrect-caching-of-silverlight-xap-file/#comment-20">Lars Holm Jenson</a>. </p>    <pre class="brush: xml;">&lt;%      string strSourceFile = @&quot;ClientBin/SilverlightApplication2.xap&quot;;      string param;      if (System.Diagnostics.Debugger.IsAttached)          param = &quot;&lt;param name=\&quot;source\&quot; value=\&quot;&quot; + strSourceFile + &quot;\&quot; /&gt;&quot;;      else      {          string xappath = HttpContext.Current.Server.MapPath(@&quot;&quot;) + @&quot;\&quot; + strSourceFile;          DateTime xapCreationDate = System.IO.File.GetLastWriteTime(xappath);          param = &quot;&lt;param name=\&quot;source\&quot; value=\&quot;&quot; + strSourceFile + &quot;?ignore=&quot;                  + xapCreationDate.ToString() + &quot;\&quot; /&gt;&quot;;      }      Response.Write(param);  %&gt; </pre>  
